<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <link rel="icon" type="image/png" href="../favicon/favicon-96x96.png" sizes="96x96" />
    <link rel="icon" type="image/svg+xml" href="../favicon/favicon.svg" />
    <link rel="shortcut icon" href="../favicon/favicon.ico" />
    <link rel="apple-touch-icon" sizes="180x180" href="../favicon/apple-touch-icon.png" />
    <link rel="manifest" href="../favicon/site.webmanifest" />
    <title>Maintenance Bosconnect</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.4.0/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.23/jspdf.plugin.autotable.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.8.1/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <link rel="stylesheet" href="maintenance.css">
    <script src="maintenance.js" defer></script>
</head>

<body>
    <header>
        <div class="header-container">
            <div class="connexion">BOSCONNECT</div>
        </div>
    </header>

    <div class="content-wrapper">
        <form id="interventionForm" class="main-container">

            <div id="step1" class="section  visible">
                <h1>Informations du technicien</h1>
                <div class="form-group">
                    <label for="interventionName">Nom intervenant:</label>
                    <input type="text" id="interventionName" name="interventionName" required>
                </div>
                <div class="form-group">
                    <label for="interventionNumber">N° d'intervention:</label>
                    <input type="text" id="interventionNumber" name="interventionNumber" required>
                </div>
                <div class="form-group">
                    <label for="bosconnectNumber">N° de carte Bosconnect:</label>
                    <input type="text" id="bosconnectNumber" name="bosconnectNumber" required>
                </div>
                <div class="form-group">
                    <label for="interventionDate">Date:</label>
                    <input type="date" id="interventionDate" name="interventionDate" required>
                </div>
                <div class="certification-container">
                    <div class="checkbox-wrapper">
                        <label for="technicianCheck">
                            Je certifie être un technicien qualifié selon la charte Bosconnect
                        </label>
                        <input type="checkbox" id="technicianCheck" required>
                    </div>
                </div>
                <button type="button" class="submit-btn" onclick="goToStep(2)" id="nextButton" disabled>Suivant</button>
            </div>

            <div id="step2" class="section">
                <h2>Guide pour la réalisation des tests</h2>
                <main>
                    <section>
                        <p>
                            La carte Bosconnect est un dispositif domotique innovant conçu pour mesurer divers
                            paramètres environnementaux tels que la <span class="highlight">température</span>, l'<span
                                class="highlight">humidité</span>, la <span class="highlight">pression</span> et les
                            <span class="highlight">gaz</span>. De plus, elle intègre des relais pour gérer des
                            appareils de plus haute puissance, avec deux relais doubles, un variateur et un relais
                            simple, ce
                            dernier étant associé au système de contrôle d'accès par RFID.
                        </p>
                        <p>
                            Destinée à une installation dans un habitat, la carte peut être contrôlée de deux manières :
                            soit directement via un écran intégré, soit à distance via une interface web utilisant les
                            services Firebase.
                        </p>
                    </section>

                    <section>
                        <h2>Prérequis pour les tests</h2>
                        <p>Avant de commencer les tests, assurez-vous de disposer des outils et bibliothèques suivantes
                            :</p>

                        <table class="tools-table">
                            <thead>
                                <tr>
                                    <th>Outils nécessaires</th>
                                    <th>Bibliothèques nécessaires</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>Alimentation 12V DC / 1A</td>
                                    <td>rfid-master</td>
                                </tr>
                                <tr>
                                    <td>Multimètre (voltmètre, ampèremètre, ohmmètre)</td>
                                    <td>TFT_eSPI-master</td>
                                </tr>
                                <tr>
                                    <td>Oscilloscope numérique 2 voies</td>
                                    <td>BH1750-1.3.0</td>
                                </tr>
                            </tbody>
                        </table>
                    </section>



                    <section class="instructions">
                        <h2>Procédure de test</h2>
                        <p>
                            Pour certains tests, vous devrez compiler le programme et le télécharger via le port USB-C
                            "CH340C" de la carte. Une fois le programme chargé, certains tests vous demanderont de taper
                            un code précis en majuscule dans le moniteur série.
                        </p>
                        <p>
                            Il est essentiel de commenter vos résultats à chaque étape du test. La fiche
                            d'intervention doit être détaillée, claire et compréhensible, afin de pouvoir facilement
                            identifier les éventuelles anomalies ou problèmes.
                        </p>
                        <p>
                            Dans le fichier compressé fourni ci-dessous, vous trouverez :
                        </p>
                        <table class="tools-table">
                            <thead>
                                <tr>
                                    <th>Fichiers et documents</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>Le programme de test complet</td>
                                </tr>
                                <tr>
                                    <td>Le programme utilisateur</td>
                                </tr>
                                <tr>
                                    <td>Une fiche d'intervention vierge</td>
                                </tr>
                                <tr>
                                    <td>La schématique de la carte Bosconnect</td>
                                </tr>
                            </tbody>
                        </table>
                    </section>

                    <section>
                        <h2>Finalisation des tests</h2>
                        <p>
                            Si <strong>aucune anomalie</strong>
                            n’est détectée, vous pouvez recompiler le programme utilisateur.
                            Dans le cas contraire, contactez le service de réparation
                            (service.reparation@bosconnect.fr).
                        </p>
                    </section>

                    <section class="warning-section">
                        <div class="attention-panel">
                            <p>
                                La carte ne doit être alimentée ni reprogrammée que si cela a été correctement demandé !
                            </p>
                        </div>
                    </section>

                    <div class="button-group">
                        <button type="button" class="submit-btn" onclick="goToStep(1)">Précédent</button>
                        <button type="button" class="submit-btn" onclick="goToStep(3)">Suivant</button>
                    </div>
                </main>
            </div>

            <div id="step3" class="section">
                <h3>Contrôles visuels</h3>
                <div class="test-item">
                    <label>La carte est-elle exempte de dégradations ?</label>
                    <div class="radio-group">
                        <label class="radio-label">
                            <input type="radio" name="test1_1" value="OK" required>
                            OK
                        </label>
                        <label class="radio-label">
                            <input type="radio" name="test1_1" value="NOK">
                            NOK
                        </label>
                    </div>
                    <textarea name="comments1_1" rows="4" placeholder="Commentaires ..."></textarea>
                </div>
                <div class="test-item">
                    <label>Tous les composants prévus sont-ils présents et correctement soudés, conformément au schéma
                        de la carte ?</label>
                    <div class="radio-group">
                        <label class="radio-label">
                            <input type="radio" name="test1_2" value="OK" required>
                            OK
                        </label>
                        <label class="radio-label">
                            <input type="radio" name="test1_2" value="NOK">
                            NOK
                        </label>
                    </div>
                    <textarea name="comments1_2" rows="4" placeholder="Commentaires ..."></textarea>
                </div>
                <div class="test-item">
                    <label>Les bords sont-ils correctement usinés et les perçages conformes ?</label>
                    <div class="radio-group">
                        <label class="radio-label">
                            <input type="radio" name="test1_3" value="OK" required>
                            OK
                        </label>
                        <label class="radio-label">
                            <input type="radio" name="test1_3" value="NOK">
                            NOK
                        </label>
                    </div>
                    <textarea name="comments1_3" rows="4" placeholder="Commentaires ..."></textarea>
                </div>
                <div class="button-group">
                    <button type="button" class="submit-btn" onclick="goToStep(2)">Précédent</button>
                    <button type="button" class="submit-btn" onclick="goToStep(4)">Suivant</button>
                </div>
            </div>

            <div id="step4" class="section">
                <h3>Contrôle des mesures</h3>
                <div class="test-item">
                    <p>
                        Si les tests précédents hors tension sont validés, vous pouvez désormais alimenter la carte via son
                        port USB-C, puis compiler le programme de test et le téléverser sur la carte. Dans le cas contraire,
                        indiquez 'NOK' pour les prochains tests et expliquez l'erreur dans l'espace dédié aux commentaires
                        finaux.
                    </p>

                    <label>Y a-t-il une tension présente sur les broches « GND » ?</label>
                    <div class="radio-group">
                        <label class="radio-label">
                            <input type="radio" name="test2_1" value="OK" required>
                            OK
                        </label>
                        <label class="radio-label">
                            <input type="radio" name="test2_1" value="NOK">
                            NOK
                        </label>
                    </div>
                    <textarea name="comments2_1" rows="4" style="width: 100%;"
                        placeholder="Commentaires ..."></textarea>
                </div>
                <div class="test-item">
                    <label>Les témoins lumineux du lecteur RFID, de l'ESP32 et du rétroéclairage de l'écran sont-ils
                        opérationnels et allumés ?</label>
                    <div class="radio-group">
                        <label class="radio-label">
                            <input type="radio" name="test2_2" value="OK" required>
                            OK
                        </label>
                        <label class="radio-label">
                            <input type="radio" name="test2_2" value="NOK">
                            NOK
                        </label>
                    </div>
                    <textarea name="comments2_2" rows="4" style="width: 100%;"
                        placeholder="Commentaires ..."></textarea>
                </div>
                <div class="button-group">
                    <button type="button" class="submit-btn" onclick="goToStep(3)">Précédent</button>
                    <button type="button" class="submit-btn" onclick="goToStep(5)">Suivant</button>
                </div>
            </div>

            <div id="step5" class="section">
                <h3>Contrôle des capteurs</h3>
                <div class="test-item">
                    <label>Test du capteur de gaz MQ9</label>
                    <p>
                        Pour tester le capteur de gaz MQ9, vérifiez la cohérence des valeurs affichées dans le moniteur
                        série. Dans un environnement normal, les valeurs varient généralement entre 1000 et 1500 ppm.
                    </p>
                    <p>
                        Tapez "MQ9" dans le moniteur série pour afficher les valeurs.
                    </p>
                    <div class="radio-group">
                        <label class="radio-label">
                            <input type="radio" name="test3_1" value="OK" required>
                            OK
                        </label>
                        <label class="radio-label">
                            <input type="radio" name="test3_1" value="NOK">
                            NOK
                        </label>
                    </div>
                    <textarea name="comments3_1" rows="4" style="width: 100%;"
                        placeholder="Commentaires ..."></textarea>
                </div>

                <div class="test-item">
                    <label>Test du capteur de température et pression BMP280</label>
                    <p>
                        Pour tester le capteur BMP280, utilisez le moniteur série pour afficher les valeurs et vérifiez
                        leur cohérence. Vous pouvez les comparer avec les données météorologiques locales.

                    </p>
                    <p>
                        Tapez "BMP280" dans le moniteur série pour afficher les valeurs.
                    </p>
                    <div class="radio-group">
                        <label class="radio-label">
                            <input type="radio" name="test3_2" value="OK" required>
                            OK
                        </label>
                        <label class="radio-label">
                            <input type="radio" name="test3_2" value="NOK">
                            NOK
                        </label>
                    </div>
                    <textarea name="comments3_2" rows="4" style="width: 100%;"
                        placeholder="Commentaires ..."></textarea>
                </div>

                <div class="test-item">
                    <label>Test du capteur de luminosité BH1750</label>
                    <p>
                        Pour tester le capteur BH1750, vérifiez la cohérence des valeurs sur le moniteur série. Vous
                        pouvez faire varier la luminosité avec une lampe ou un téléphone.
                    </p>
                    <p>
                        Tapez "BH1750" dans le moniteur série pour afficher les valeurs.
                    </p>
                    <div class="radio-group">
                        <label class="radio-label">
                            <input type="radio" name="test3_3" value="OK" required>
                            OK
                        </label>
                        <label class="radio-label">
                            <input type="radio" name="test3_3" value="NOK">
                            NOK
                        </label>
                    </div>
                    <textarea name="comments3_3" rows="4" style="width: 100%;"
                        placeholder="Commentaires ..."></textarea>
                </div>

                <div class="button-group">
                    <button type="button" class="submit-btn" onclick="goToStep(4)">Précédent</button>
                    <button type="button" class="submit-btn" onclick="goToStep(6)">Suivant</button>
                </div>
            </div>

            <div id="step6" class="section">
                <h3>Contrôle des actionneurs</h3>
                <div class="test-item">
                    <p>
                        Pour tester un relais double, commencez par connecter le voltmètre en mode testeur de continuité
                        sur les vis des borniers où sont placées les phases. Ensuite, répétez l’opération sur les vis
                        des borniers où sont placés les neutres.
                    </p>
                    <p>
                        Pour un relais simple, positionnez le voltmètre en mode testeur de continuité sur chaque vis du
                        relais afin de mesurer son activation.
                    </p>

                    <p>
                        Exécutez ensuite le programme en utilisant la commande appropriée sur le
                        terminal série. Vérifiez que le relais s’active pendant 4 secondes et qu’il se referme
                        correctement après cette période.
                    </p>

                    <label>Test du relais double appareil 1</label>
                    <p>
                        Pour tester le relais double de l'appareil 1, saisissez "RELAIS_1" dans le moniteur série.
                        Ensuite, mesurez la continuité entre les bornes à vis : PHASE_AP1 et
                        NEUTRE_AP1.
                    </p>

                    <div class="radio-group">
                        <label class="radio-label">
                            <input type="radio" name="test4_1" value="OK" required>
                            OK
                        </label>
                        <label class="radio-label">
                            <input type="radio" name="test4_1" value="NOK">
                            NOK
                        </label>
                    </div>
                    <textarea name="comments4_1" rows="4" style="width: 100%;"
                        placeholder="Commentaires ..."></textarea>
                </div>

                <div class="test-item">
                    <label>Test du relais double appareil 2</label>
                    <p>
                        Pour tester le relais double de l'appareil 2, saisissez "RELAIS_2" dans le moniteur série.
                        Ensuite, mesurez la continuité sur les bornes à vis : PHASE_AP2 et
                        NEUTRE_AP2.
                    </p>

                    <div class="radio-group">
                        <label class="radio-label">
                            <input type="radio" name="test4_2" value="OK" required>
                            OK
                        </label>
                        <label class="radio-label">
                            <input type="radio" name="test4_2" value="NOK">
                            NOK
                        </label>
                    </div>
                    <textarea name="comments4_2" rows="4" style="width: 100%;"
                        placeholder="Commentaires ..."></textarea>
                </div>
                <div class="test-item">
                    <label>Test du relais simple</label>
                    <p>
                        Pour tester le relais simple associé au fonctionnement du RFID, saisissez "RELAIS_RFID" dans le
                        moniteur série. Ensuite, mesurez la continuité sur le bornier RELAIS_RFID.
                    </p>

                    <div class="radio-group">
                        <label class="radio-label">
                            <input type="radio" name="test4_3" value="OK" required>
                            OK
                        </label>
                        <label class="radio-label">
                            <input type="radio" name="test4_3" value="NOK">
                            NOK
                        </label>
                    </div>
                    <textarea name="comments4_3" rows="4" style="width: 100%;"
                        placeholder="Commentaires ..."></textarea>

                </div>

                <div class="test-item">
                    <label>Test du variateur</label>
                    <p>
                        Pour réaliser ce test, commencez par connecter un GBF (Générateur de Basse Fréquence) à l’entrée
                        du
                        bornier à vis VARIATEUR_IN. Ensuite, reliez une sonde à un oscilloscope et connectez-la à la
                        sortie
                        du bornier VARIATEUR_OUT. Configurez l’oscilloscope de manière à afficher simultanément les
                        signaux
                        d’entrée et de sortie.
                    </p>

                    <p>
                        Lancez ensuite le programme en utilisant la commande "VARIATEUR" sur le terminal série. Vous
                        devriez
                        constater
                        que l’onde sinusoïdale de sortie est modulée en fonction des paramètres du variateur, ce qui
                        reflète
                        les changements effectués par ce dernier. Vérifiez que cette modulation est cohérente et
                        conforme
                        aux attentes.
                    </p>

                    <div class="radio-group">
                        <label class="radio-label">
                            <input type="radio" name="test4_4" value="OK" required>
                            OK
                        </label>
                        <label class="radio-label">
                            <input type="radio" name="test4_4" value="NOK">
                            NOK
                        </label>
                    </div>
                    <textarea name="comments4_4" rows="4" style="width: 100%;"
                        placeholder="Commentaires ..."></textarea>
                </div>
                <div class="button-group">
                    <button type="button" class="submit-btn" onclick="goToStep(5)">Précédent</button>
                    <button type="button" class="submit-btn" onclick="goToStep(7)">Suivant</button>
                </div>
            </div>


            <div id="step7" class="section">
                <h3>Contrôle des indicateurs</h3>
                <div class="test-item">
                    <label>Test de l'écran tactile</label>
                    <p>
                        Pour tester l'écran tactile, utilisez le stylet fourni et saisissez "ECRAN" dans le moniteur
                        série.
                    </p>

                    <p>
                        Suivez ensuite les indications de calibrage affichées à l'écran. Vérifiez si tous les endroits
                        de l'écran répondent correctement, ainsi que l'absence de couleurs ou de pixels manquants.
                    </p>

                    <div class="radio-group">
                        <label class="radio-label">
                            <input type="radio" name="test5_1" value="OK" required>
                            OK
                        </label>
                        <label class="radio-label">
                            <input type="radio" name="test5_1" value="NOK">
                            NOK
                        </label>
                    </div>
                    <textarea name="comments5_1" rows="4" style="width: 100%;"
                        placeholder="Commentaires ..."></textarea>
                </div>

                <div class="test-item">
                    <label>Test de la LED RGB</label>
                    <p>
                        Pour tester la LED RGB, saisissez "RGB" dans le moniteur série. Vérifiez si la LED change
                        correctement de couleur toutes les secondes.
                    </p>
                    <div class="radio-group">
                        <label class="radio-label">
                            <input type="radio" name="test5_2" value="OK" required>
                            OK
                        </label>
                        <label class="radio-label">
                            <input type="radio" name="test5_2" value="NOK">
                            NOK
                        </label>
                    </div>
                    <textarea name="comments5_2" rows="4" style="width: 100%;"
                        placeholder="Commentaires ..."></textarea>
                </div>
                <div class="button-group">
                    <button type="button" class="submit-btn" onclick="goToStep(6)">Précédent</button>
                    <button type="button" class="submit-btn" onclick="goToStep(8)">Suivant</button>
                </div>
            </div>

            <div id="step8" class="section">
                <h3>Contrôle de la connectivité</h3>
                <div class="test-item">
                    <label>Test de la connectivité Wifi</label>
                    <p>
                        Dans le code C++ fourni, modifiez le SSID du wifi et le mot de passe, puis téléversez le code.
                        Dans le moniteur série, saisissez "WIFI" pour vérifier la connexion. Suivez les étapes sur le
                        moniteur série pour vérifier la connexion. La connexion est-elle bien établie ?
                    </p>
                    <div class="radio-group">
                        <label class="radio-label">
                            <input type="radio" name="test6_1" value="OK" required>
                            OK
                        </label>
                        <label class="radio-label">
                            <input type="radio" name="test6_1" value="NOK">
                            NOK
                        </label>
                    </div>
                    <textarea name="comments6_1" rows="4" style="width: 100%;" placeholder="Commentaires ..."></textarea>
                </div>

                <div class="test-item">
                    <label>Test des données</label>
                    <p>
                        Si la carte a correctement été connectée au wifi, connectez-vous sur la page de contrôle
                        Bosconnect. Appuyez sur les boutons suivants pour allumer ou éteindre un appareil et vérifier si les données du capteur sont correctement envoyées.
                    </p>
                    <div class="sensor-control">
                        <div class="button-group">
                            <button type="button" class="submit-btn on-btn" onclick="turnOnDevice()">Allumer l'appareil</button>
                            <button type="button" class="submit-btn off-btn" onclick="turnOffDevice()">Éteindre l'appareil</button>
                        </div>
                        <p id="sensorValueDisplay">Valeur actuelle du capteur : <span id="sensorValue">N/A</span></p>
                    </div>
                    <div class="radio-group">
                        <label class="radio-label">
                            <input type="radio" name="test6_2" value="OK" required>
                            OK
                        </label>
                        <label class="radio-label">
                            <input type="radio" name="test6_2" value="NOK">
                            NOK
                        </label>
                    </div>
                    <textarea name="comments6_2" rows="4" style="width: 100%;" placeholder="Commentaires ..."></textarea>
                </div>
                <div class="test-completed-container">
                    <input type="checkbox" id="testsCompleted" required>
                    <label for="testsCompleted">
                        Je certifie que tous les tests ont été correctement réalisés.
                    </label>
                </div>
                <div class="button-group">
                    <button type="button" class="submit-btn" onclick="goToStep(7)">Précédent</button>
                    <button type="button" id="exportPdf" class="submit-btn" disabled>Exporter en PDF</button>
                </div>
            </div>

        </form>
    </div>

    <footer>
        <div class="footer-container">
            <p>&copy; 2024 BOSCONNECT. Tous droits réservés.</p>
            <p>
                <a href="#privacy-policy">Politique de confidentialité</a> |
                <a href="#terms">Conditions d'utilisation</a>
            </p>
        </div>
    </footer>
</body>

</html>